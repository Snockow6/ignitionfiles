variant: fcos
version: 1.4.0
passwd:
  users:
    - name: nathan
      groups:
        - wheel
      password_hash: $y$j9T$UJBWzpzCD9bEX3WjQlGkU1$5LLzqOxhpKuz4qMWadyZvZqrmwgBe7yy2/BX5GUD9l9
      ssh_authorized_keys:
        - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCw787L+CRwrzVyiKzuFG534zu32yCR+odo3SY35bsSR9IHTT6lCc91eeb2ORDRomFCFUu6Gu6mxLOqkKcXXkxoNL8v/wbVeGtLx+jd97tNgu7KHIfB9qmTxGI3qXvNYOb58BgrIdEB7CErHvXVCd563Gnx927TzhO/cdVSMb6OOXQcxjfFzj1re4MRqMs0gLtXWhH5zVdOJmT825ZwjrppyR0bQMi993c+ypZ7bRE2EOGe28pAoWR0pQYccORxCUcMpWXpzhhIH9uZ5WhMcenjwqBT23zFQMCMPz+c0ogDHGCK3Egnrw8OHBynSdX62XFJ9tWkrfqqBNWs4imqqHbocWlKu+6S006p4jh/dCvolE9psZiXLG+Niw+mnN3s4AyiiMl9xdG4cHJvokQzjrHArPjy6LhLST2f18OV+0YPNikIFOv9O0XYWkyFRBirgAmT5d2UBRA71lUMhy+ljq2rCIURnmBdIYh0QSJmNcrQWkR52nAz//rWkcKvkK5xHvM= nathan@nathan-lp

systemd:
  units:
    - name: podman.socket
      enabled: true

    - name: create-portianer-data.service
      enabled: true
      contents: |
        [Unit]
        Description=Create Portainer Data
        Wants=network-online.target
        After=network-online.target

        [Service]
        Type=oneshot
        ExecStart=/usr/bin/podman volume create Portainer_Data

        [Install]
        WantedBy=multi-user.target

    - name: container-Portainer.service
      enabled: true
      contents: |
          [Unit]
          Description=Run Portainer
          Wants=multi-user.target
          After=multi-user.target

          [Service]
          TimeoutStartSec=0
          ExecStartPre=-/bin/podman kill Heimdall
          ExecStartPre=-/bin/podman rm Heimdall
          ExecStartPre=/bin/podman pull lscr.io/linuxserver/heimdall
          ExecStart=/usr/bin/podman run -d \
            --name Portainer \
            -p 8000:8000 \
            -p 9443:9433 \
            -v /var/run/podman/podman.sock:/var/run/docker.sock \
            -v Portainer_Data:/data \
            --restart=always \
            docker.io/portainer/portainer-ce:2.11.0
          ExecStop=/bin/podman rm -f Portainer

          [Install]
          WantedBy=multi-user.target
